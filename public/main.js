'use strict';

var app = angular.module('App', ['ui.router', 'ngAnimate']);

app.config(function ($urlRouterProvider, $locationProvider) {
  $locationProvider.html5Mode(true);
  $urlRouterProvider.otherwise('/main');
});

app.run(function ($rootScope) {
  return $rootScope.$on('$stateChangeError', function (event, toState, toParams, fromState, fromParams, thrownError) {
    console.info('The following error was thrown by ui-router while transitioning to state "' + toState.name + '". The origin of this error is probably a resolve function:');
    console.error(thrownError);
  });
});

'use strict';

app.config(function ($stateProvider) {
  return $stateProvider.state('main', {
    url: '/main',
    views: {
      '': { templateUrl: 'src/templates/main.template.html', conroller: 'MainCtrl' },
      'bg@main': { templateUrl: 'src/templates/bg.template.html' },
      'form@main': { templateUrl: 'src/templates/form.template.html', controller: 'MainCtrl' },
      'footer@main': { templateUrl: 'src/templates/footer.template.html' }
    }
  });
});
'use strict';

app.controller('MainCtrl', function ($scope, RateFactory, LoanFactory) {

  RateFactory.fetch_rates().then(function (data) {
    return $scope.rates = data;
  });

  $scope.default_loan_form = { amount: '', start_month: '', number_of_months: '', custom_rate: '', federal_rate: '', federal: '', custom: '' };
  $scope.default_loan_schedule = [];
  $scope.default_result = { est_payment: '', subtotal_principal: '', subtotal_interest: '' };

  $scope.reset = function () {
    $scope.loan = angular.copy($scope.default_loan_form);
    $scope.schedule = angular.copy($scope.default_loan_schedule);
    $scope.result = angular.copy($scope.default_result);
    $scope.show_loan_schedule = false;
    $scope.loan_start_month_warning = '';
    $scope.loan_rate_error = '';
    $scope.loan_rate_warning = '';
    if ($scope.form) {
      $scope.form.$setPristine();
      $scope.form.$setUntouched();
    }
  };
  $scope.reset();

  $scope.update = function () {
    //TODO: money value format // const format = (n, currency) => currency + " " + Number(n).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
    $scope.validate_loan_rate();
    $scope.calculate_schedule();
  };

  $scope.toggle_show_loan_schedule = function () {
    if ($scope.schedule.length > 0) $scope.show_loan_schedule = !$scope.show_loan_schedule;
  };

  $scope.open_loan_schedule = function () {
    if ($scope.schedule.length > 0 && $scope.show_loan_schedule == true) return true;else return false;
  };

  $scope.validate_loan_rate = function () {
    $scope.loan_start_month_warning = '';
    $scope.loan_rate_error = '';
    $scope.loan_rate_warning = '';
    var _$scope$form = $scope.form,
        custom = _$scope$form.custom,
        federal = _$scope$form.federal,
        start = _$scope$form.start; // error validation

    var _$scope$loan = $scope.loan,
        custom_rate = _$scope$loan.custom_rate,
        federal_rate = _$scope$loan.federal_rate,
        start_month = _$scope$loan.start_month; // form values

    if (start.$touched && !start_month) $scope.loan_start_month_warning = 'If you don\'t choose a starting month, current month will be applied';
    if (custom.$pristine && federal.$pristine) $scope.loan_rate_error = '';else {
      if ((!custom_rate || custom_rate <= 0) && !federal_rate) $scope.loan_rate_error = 'Please either fill out the custom rate or select an option';
      if (custom_rate > 0 && federal_rate) $scope.loan_rate_warning = 'If you choose both interests, custom interest will be applied';
    }
  };

  $scope.calculate_schedule = function () {
    var _$scope$loan2 = $scope.loan,
        amount = _$scope$loan2.amount,
        start_month = _$scope$loan2.start_month,
        number_of_months = _$scope$loan2.number_of_months,
        custom_rate = _$scope$loan2.custom_rate,
        federal_rate = _$scope$loan2.federal_rate;

    if (+amount > 0 && +number_of_months > 0 && (+custom_rate > 0 || federal_rate > 0)) {
      $scope.schedule = LoanFactory.calculate_schedule($scope.loan);
      $scope.subtotal_payment = $scope.schedule.map(function (s) {
        return +s.payment;
      }).reduce(function (prev, curr) {
        return prev + curr;
      }, 0);
      $scope.subtotal_principal = $scope.schedule.map(function (s) {
        return +s.principal;
      }).reduce(function (prev, curr) {
        return prev + curr;
      }, 0);
      $scope.subtotal_interest = $scope.schedule.map(function (s) {
        return +s.interest;
      }).reduce(function (prev, curr) {
        return prev + curr;
      }, 0);

      $scope.result.est_payment = $scope.schedule[0].payment;
      $scope.result.subtotal_principal = $scope.subtotal_principal;
      $scope.result.subtotal_interest = $scope.subtotal_interest;
    }
  };
});
'use strict';

app.factory('LoanFactory', function ($http, $log) {

  var calculate_schedule = function calculate_schedule(loan) {
    var d = new Date();
    var default_start_month = d.setDate(d.getMonth() + 1);
    var u = new Date(default_start_month);
    if (!loan.start_month) loan.start_month = u;

    var schedule = [];
    var m = +loan.number_of_months;
    var amount = +loan.amount;
    var r = +loan.custom_rate > 0 ? +loan.custom_rate / 100 : +loan.federal_rate;
    var annuity_factor = (1 - 1 / Math.pow(1 + r / m, m)) / (r / m);
    var pmt = amount / annuity_factor;
    var months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

    var balance = amount;
    var paid_principal = 0;
    var y = 0;
    for (var i = 0; i < m; i++) {
      if ((loan.start_month.getMonth() + i) % 12 == 11) y += 1;
      var year = loan.start_month.getFullYear() + y;
      var month = months[(loan.start_month.getMonth() + i + 1) % 12] + '-' + year;
      if (i == m - 1) {
        var interest = (balance * (r / m)).toFixed(2);
        var principal = (amount - paid_principal).toFixed(2);
        var payment = (Number(interest) + Number(principal)).toFixed(2);
        balance = 0;
        schedule.push({ month: month, payment: payment, principal: principal, interest: interest, balance: balance });
      } else {

        var _payment = pmt.toFixed(2);
        var _interest = (balance * (r / m)).toFixed(2);
        var _principal = (_payment - balance * (r / m)).toFixed(2);
        paid_principal += Number(_principal);
        balance = (balance - _principal).toFixed(2);
        schedule.push({ month: month, payment: _payment, principal: _principal, interest: _interest, balance: balance });
      }
    }
    return schedule;
  };

  return { calculate_schedule: calculate_schedule };
});

'use strict';

app.factory('RateFactory', function ($http, $log) {
  var rates = [];

  var fetch_rates = function fetch_rates() {
    if (rates.length == 0) return $http.get('/api/rates').then(function (res) {
      return rates = res.data;
    });else if (new Date() - rates[0].updated_at > 24 * 60 * 60 * 1000) return $http.get('/api/rates').then(function (res) {
      return rates = res.data;
    });
    return rates;
  };

  return { fetch_rates: fetch_rates };
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInN0YXRlcy5qcyIsImNvbnRyb2xsZXJzL21haW4uY29udHJvbGxlci5qcyIsImZhY3Rvcmllcy9sb2FuLmZhY3RvcnkuanMiLCJmYWN0b3JpZXMvcmF0ZS5mYWN0b3J5LmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCIkdXJsUm91dGVyUHJvdmlkZXIiLCIkbG9jYXRpb25Qcm92aWRlciIsImh0bWw1TW9kZSIsIm90aGVyd2lzZSIsInJ1biIsIiRyb290U2NvcGUiLCIkb24iLCJldmVudCIsInRvU3RhdGUiLCJ0b1BhcmFtcyIsImZyb21TdGF0ZSIsImZyb21QYXJhbXMiLCJ0aHJvd25FcnJvciIsImNvbnNvbGUiLCJpbmZvIiwibmFtZSIsImVycm9yIiwiJHN0YXRlUHJvdmlkZXIiLCJzdGF0ZSIsInVybCIsInZpZXdzIiwidGVtcGxhdGVVcmwiLCJjb25yb2xsZXIiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiUmF0ZUZhY3RvcnkiLCJMb2FuRmFjdG9yeSIsImZldGNoX3JhdGVzIiwidGhlbiIsInJhdGVzIiwiZGF0YSIsImRlZmF1bHRfbG9hbl9mb3JtIiwiYW1vdW50Iiwic3RhcnRfbW9udGgiLCJudW1iZXJfb2ZfbW9udGhzIiwiY3VzdG9tX3JhdGUiLCJmZWRlcmFsX3JhdGUiLCJmZWRlcmFsIiwiY3VzdG9tIiwiZGVmYXVsdF9sb2FuX3NjaGVkdWxlIiwiZGVmYXVsdF9yZXN1bHQiLCJlc3RfcGF5bWVudCIsInN1YnRvdGFsX3ByaW5jaXBhbCIsInN1YnRvdGFsX2ludGVyZXN0IiwicmVzZXQiLCJsb2FuIiwiY29weSIsInNjaGVkdWxlIiwicmVzdWx0Iiwic2hvd19sb2FuX3NjaGVkdWxlIiwibG9hbl9zdGFydF9tb250aF93YXJuaW5nIiwibG9hbl9yYXRlX2Vycm9yIiwibG9hbl9yYXRlX3dhcm5pbmciLCJmb3JtIiwiJHNldFByaXN0aW5lIiwiJHNldFVudG91Y2hlZCIsInVwZGF0ZSIsInZhbGlkYXRlX2xvYW5fcmF0ZSIsImNhbGN1bGF0ZV9zY2hlZHVsZSIsInRvZ2dsZV9zaG93X2xvYW5fc2NoZWR1bGUiLCJsZW5ndGgiLCJvcGVuX2xvYW5fc2NoZWR1bGUiLCJzdGFydCIsIiR0b3VjaGVkIiwiJHByaXN0aW5lIiwic3VidG90YWxfcGF5bWVudCIsIm1hcCIsInMiLCJwYXltZW50IiwicmVkdWNlIiwicHJldiIsImN1cnIiLCJwcmluY2lwYWwiLCJpbnRlcmVzdCIsImZhY3RvcnkiLCIkaHR0cCIsIiRsb2ciLCJkIiwiRGF0ZSIsImRlZmF1bHRfc3RhcnRfbW9udGgiLCJzZXREYXRlIiwiZ2V0TW9udGgiLCJ1IiwibSIsInIiLCJhbm51aXR5X2ZhY3RvciIsIk1hdGgiLCJwb3ciLCJwbXQiLCJtb250aHMiLCJiYWxhbmNlIiwicGFpZF9wcmluY2lwYWwiLCJ5IiwiaSIsInllYXIiLCJnZXRGdWxsWWVhciIsIm1vbnRoIiwidG9GaXhlZCIsIk51bWJlciIsInB1c2giLCJnZXQiLCJyZXMiLCJ1cGRhdGVkX2F0Il0sIm1hcHBpbmdzIjoiOztBQUFBLElBQUFBLE1BQUFDLFFBQUFDLE1BQUEsQ0FBQSxLQUFBLEVBQUEsQ0FBQSxXQUFBLEVBQUEsV0FBQSxDQUFBLENBQUE7O0FBRUFGLElBQUFHLE1BQUEsQ0FBQSxVQUFBQyxrQkFBQSxFQUFBQyxpQkFBQSxFQUFBO0FBQ0FBLG9CQUFBQyxTQUFBLENBQUEsSUFBQTtBQUNBRixxQkFBQUcsU0FBQSxDQUFBLE9BQUE7QUFDQSxDQUhBOztBQUtBUCxJQUFBUSxHQUFBLENBQUEsVUFBQUMsVUFBQTtBQUFBLFNBQ0FBLFdBQUFDLEdBQUEsQ0FBQSxtQkFBQSxFQUFBLFVBQUFDLEtBQUEsRUFBQUMsT0FBQSxFQUFBQyxRQUFBLEVBQUFDLFNBQUEsRUFBQUMsVUFBQSxFQUFBQyxXQUFBLEVBQUE7QUFDQUMsWUFBQUMsSUFBQSxnRkFBQU4sUUFBQU8sSUFBQTtBQUNBRixZQUFBRyxLQUFBLENBQUFKLFdBQUE7QUFDQSxHQUhBLENBREE7QUFBQSxD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QSxJQUFBLENBQUEsRUFBQSxPQUFBZSxNQUFBeUIsR0FBQSxDQUFBLFlBQUEsRUFBQXhFLElBQUEsQ0FBQTtBQUFBLGFBQUFDLFFBQUF3RSxJQUFBdkUsSUFBQTtBQUFBLEtBQUEsQ0FBQSxDQUFBLEtBQ0EsSUFBQSxJQUFBZ0QsSUFBQSxLQUFBakQsTUFBQSxDQUFBLEVBQUF5RSxVQUFBLEdBQUEsS0FBQSxFQUFBLEdBQUEsRUFBQSxHQUFBLElBQUEsRUFBQSxPQUFBM0IsTUFBQXlCLEdBQUEsQ0FBQSxZQUFBLEVBQUF4RSxJQUFBLENBQUE7QUFBQSxhQUFBQyxRQUFBd0UsSUFBQXZFLElBQUE7QUFBQSxLQUFBLENBQUE7QUFDQSxXQUFBRCxLQUFBO0FBQ0EsR0FKQTs7QUFNQSxTQUFBLEVBQUFGLHdCQUFBLEVBQUE7QUFDQSxDQVZBIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnQXBwJywgWyd1aS5yb3V0ZXInLCAnbmdBbmltYXRlJ10pO1xuXG5hcHAuY29uZmlnKCgkdXJsUm91dGVyUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyKSA9PiB7XG4gICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcbiAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnL21haW4nKTtcbn0pXG5cbmFwcC5ydW4oKCRyb290U2NvcGUpID0+XG4gICRyb290U2NvcGUuJG9uKCckc3RhdGVDaGFuZ2VFcnJvcicsIChldmVudCwgdG9TdGF0ZSwgdG9QYXJhbXMsIGZyb21TdGF0ZSwgZnJvbVBhcmFtcywgdGhyb3duRXJyb3IpID0+IHtcbiAgICBjb25zb2xlLmluZm8oYFRoZSBmb2xsb3dpbmcgZXJyb3Igd2FzIHRocm93biBieSB1aS1yb3V0ZXIgd2hpbGUgdHJhbnNpdGlvbmluZyB0byBzdGF0ZSBcIiR7dG9TdGF0ZS5uYW1lfVwiLiBUaGUgb3JpZ2luIG9mIHRoaXMgZXJyb3IgaXMgcHJvYmFibHkgYSByZXNvbHZlIGZ1bmN0aW9uOmApO1xuICAgIGNvbnNvbGUuZXJyb3IodGhyb3duRXJyb3IpO1xuICB9KVxuKVxuIiwiJ3VzZSBzdHJpY3QnXG5cbmFwcC5jb25maWcoKCRzdGF0ZVByb3ZpZGVyKSA9PlxuICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnbWFpbicsIHtcbiAgICB1cmw6ICcvbWFpbicsXG4gICAgdmlld3M6IHtcbiAgICAgICcnOiB7IHRlbXBsYXRlVXJsOiAnc3JjL3RlbXBsYXRlcy9tYWluLnRlbXBsYXRlLmh0bWwnLCBjb25yb2xsZXI6ICdNYWluQ3RybCd9LFxuICAgICAgJ2JnQG1haW4nOiB7dGVtcGxhdGVVcmw6ICdzcmMvdGVtcGxhdGVzL2JnLnRlbXBsYXRlLmh0bWwnfSxcbiAgICAgICdmb3JtQG1haW4nOiB7dGVtcGxhdGVVcmw6ICdzcmMvdGVtcGxhdGVzL2Zvcm0udGVtcGxhdGUuaHRtbCcsIGNvbnRyb2xsZXI6ICdNYWluQ3RybCd9LFxuICAgICAgJ2Zvb3RlckBtYWluJzogeyB0ZW1wbGF0ZVVybDogJ3NyYy90ZW1wbGF0ZXMvZm9vdGVyLnRlbXBsYXRlLmh0bWwnIH1cbiAgICB9XG4gIH0pXG4pIiwiJ3VzZSBzdHJpY3QnXG5cbmFwcC5jb250cm9sbGVyKCdNYWluQ3RybCcsICgkc2NvcGUsIFJhdGVGYWN0b3J5LCBMb2FuRmFjdG9yeSkgPT4ge1xuXG4gIFJhdGVGYWN0b3J5LmZldGNoX3JhdGVzKCkudGhlbihkYXRhID0+ICRzY29wZS5yYXRlcyA9IGRhdGEpO1xuXG4gICRzY29wZS5kZWZhdWx0X2xvYW5fZm9ybSA9IHsgYW1vdW50OiAnJywgc3RhcnRfbW9udGg6ICcnLCBudW1iZXJfb2ZfbW9udGhzOiAnJywgY3VzdG9tX3JhdGU6ICcnLCBmZWRlcmFsX3JhdGU6ICcnLCBmZWRlcmFsOiAnJywgY3VzdG9tOiAnJyB9O1xuICAkc2NvcGUuZGVmYXVsdF9sb2FuX3NjaGVkdWxlID0gW107XG4gICRzY29wZS5kZWZhdWx0X3Jlc3VsdCA9IHsgZXN0X3BheW1lbnQ6ICcnLCBzdWJ0b3RhbF9wcmluY2lwYWw6ICcnLCBzdWJ0b3RhbF9pbnRlcmVzdDogJyd9O1xuXG5cbiAgJHNjb3BlLnJlc2V0ID0gKCkgPT4ge1xuICAgICRzY29wZS5sb2FuID0gYW5ndWxhci5jb3B5KCRzY29wZS5kZWZhdWx0X2xvYW5fZm9ybSk7XG4gICAgJHNjb3BlLnNjaGVkdWxlID0gYW5ndWxhci5jb3B5KCRzY29wZS5kZWZhdWx0X2xvYW5fc2NoZWR1bGUpO1xuICAgICRzY29wZS5yZXN1bHQgPSBhbmd1bGFyLmNvcHkoJHNjb3BlLmRlZmF1bHRfcmVzdWx0KTtcbiAgICAkc2NvcGUuc2hvd19sb2FuX3NjaGVkdWxlID0gZmFsc2U7XG4gICAgJHNjb3BlLmxvYW5fc3RhcnRfbW9udGhfd2FybmluZyA9ICcnO1xuICAgICRzY29wZS5sb2FuX3JhdGVfZXJyb3IgPSAnJztcbiAgICAkc2NvcGUubG9hbl9yYXRlX3dhcm5pbmcgPSAnJztcbiAgICBpZiAoJHNjb3BlLmZvcm0pIHtcbiAgICAgICRzY29wZS5mb3JtLiRzZXRQcmlzdGluZSgpO1xuICAgICAgJHNjb3BlLmZvcm0uJHNldFVudG91Y2hlZCgpO1xuICAgIH1cbiAgfVxuICAkc2NvcGUucmVzZXQoKTtcblxuICAkc2NvcGUudXBkYXRlID0gKCkgPT4ge1xuICAgIC8vVE9ETzogbW9uZXkgdmFsdWUgZm9ybWF0IC8vIGNvbnN0IGZvcm1hdCA9IChuLCBjdXJyZW5jeSkgPT4gY3VycmVuY3kgKyBcIiBcIiArIE51bWJlcihuKS50b0ZpeGVkKDIpLnJlcGxhY2UoLyhcXGQpKD89KFxcZHszfSkrXFwuKS9nLCAnJDEsJyk7XG4gICAgJHNjb3BlLnZhbGlkYXRlX2xvYW5fcmF0ZSgpO1xuICAgICRzY29wZS5jYWxjdWxhdGVfc2NoZWR1bGUoKTtcbiAgfVxuXG4gICRzY29wZS50b2dnbGVfc2hvd19sb2FuX3NjaGVkdWxlID0gKCkgPT4ge1xuICAgIGlmICgkc2NvcGUuc2NoZWR1bGUubGVuZ3RoID4gMCkgJHNjb3BlLnNob3dfbG9hbl9zY2hlZHVsZSA9ICEkc2NvcGUuc2hvd19sb2FuX3NjaGVkdWxlO1xuICB9XG5cbiAgJHNjb3BlLm9wZW5fbG9hbl9zY2hlZHVsZSA9ICgpID0+IHtcbiAgICBpZiAoJHNjb3BlLnNjaGVkdWxlLmxlbmd0aCA+IDAgJiYgJHNjb3BlLnNob3dfbG9hbl9zY2hlZHVsZSA9PSB0cnVlKSByZXR1cm4gdHJ1ZTtcbiAgICBlbHNlIHJldHVybiBmYWxzZTtcbiAgfVxuXG5cbiAgJHNjb3BlLnZhbGlkYXRlX2xvYW5fcmF0ZSA9ICgpID0+IHtcbiAgICAkc2NvcGUubG9hbl9zdGFydF9tb250aF93YXJuaW5nID0gJyc7XG4gICAgJHNjb3BlLmxvYW5fcmF0ZV9lcnJvciA9ICcnO1xuICAgICRzY29wZS5sb2FuX3JhdGVfd2FybmluZyA9ICcnO1xuICAgIGNvbnN0IHsgY3VzdG9tLCBmZWRlcmFsLCBzdGFydCB9ID0gJHNjb3BlLmZvcm07IC8vIGVycm9yIHZhbGlkYXRpb25cbiAgICBjb25zdCB7IGN1c3RvbV9yYXRlLCBmZWRlcmFsX3JhdGUsIHN0YXJ0X21vbnRoIH0gPSAkc2NvcGUubG9hbjsgLy8gZm9ybSB2YWx1ZXNcblxuICAgIGlmIChzdGFydC4kdG91Y2hlZCAmJiAhc3RhcnRfbW9udGgpICRzY29wZS5sb2FuX3N0YXJ0X21vbnRoX3dhcm5pbmcgPSBgSWYgeW91IGRvbid0IGNob29zZSBhIHN0YXJ0aW5nIG1vbnRoLCBjdXJyZW50IG1vbnRoIHdpbGwgYmUgYXBwbGllZGBcbiAgICBpZiAoY3VzdG9tLiRwcmlzdGluZSAmJiBmZWRlcmFsLiRwcmlzdGluZSkgJHNjb3BlLmxvYW5fcmF0ZV9lcnJvciA9ICcnO1xuICAgIGVsc2Uge1xuICAgICAgaWYgKCghY3VzdG9tX3JhdGUgfHwgY3VzdG9tX3JhdGUgPD0gMCkgJiYgIWZlZGVyYWxfcmF0ZSkgJHNjb3BlLmxvYW5fcmF0ZV9lcnJvciA9ICdQbGVhc2UgZWl0aGVyIGZpbGwgb3V0IHRoZSBjdXN0b20gcmF0ZSBvciBzZWxlY3QgYW4gb3B0aW9uJztcbiAgICAgIGlmIChjdXN0b21fcmF0ZSA+IDAgJiYgZmVkZXJhbF9yYXRlKSAkc2NvcGUubG9hbl9yYXRlX3dhcm5pbmcgPSAnSWYgeW91IGNob29zZSBib3RoIGludGVyZXN0cywgY3VzdG9tIGludGVyZXN0IHdpbGwgYmUgYXBwbGllZCc7XG4gICAgfVxuICB9XG5cbiAgJHNjb3BlLmNhbGN1bGF0ZV9zY2hlZHVsZSA9ICgpID0+IHtcbiAgICBjb25zdCB7IGFtb3VudCwgc3RhcnRfbW9udGgsIG51bWJlcl9vZl9tb250aHMsIGN1c3RvbV9yYXRlLCBmZWRlcmFsX3JhdGUgfSA9ICRzY29wZS5sb2FuO1xuICAgIGlmICgrYW1vdW50ID4gMCAmJiArbnVtYmVyX29mX21vbnRocyA+IDAgJiYgKCtjdXN0b21fcmF0ZSA+IDAgfHwgZmVkZXJhbF9yYXRlID4gMCkgKSB7XG4gICAgICAkc2NvcGUuc2NoZWR1bGUgPSBMb2FuRmFjdG9yeS5jYWxjdWxhdGVfc2NoZWR1bGUoJHNjb3BlLmxvYW4pO1xuICAgICAgJHNjb3BlLnN1YnRvdGFsX3BheW1lbnQgPSAkc2NvcGUuc2NoZWR1bGUubWFwKHMgPT4gK3MucGF5bWVudCkucmVkdWNlKChwcmV2LCBjdXJyKSA9PiBwcmV2ICsgY3VyciwgMCk7XG4gICAgICAkc2NvcGUuc3VidG90YWxfcHJpbmNpcGFsID0gJHNjb3BlLnNjaGVkdWxlLm1hcChzID0+ICtzLnByaW5jaXBhbCkucmVkdWNlKChwcmV2LCBjdXJyKSA9PiBwcmV2ICsgY3VyciwgMCk7XG4gICAgICAkc2NvcGUuc3VidG90YWxfaW50ZXJlc3QgPSAkc2NvcGUuc2NoZWR1bGUubWFwKHMgPT4gK3MuaW50ZXJlc3QpLnJlZHVjZSgocHJldiwgY3VycikgPT4gcHJldiArIGN1cnIsIDApO1xuXG4gICAgICAkc2NvcGUucmVzdWx0LmVzdF9wYXltZW50ID0gJHNjb3BlLnNjaGVkdWxlWzBdLnBheW1lbnQ7XG4gICAgICAkc2NvcGUucmVzdWx0LnN1YnRvdGFsX3ByaW5jaXBhbCA9ICRzY29wZS5zdWJ0b3RhbF9wcmluY2lwYWw7XG4gICAgICAkc2NvcGUucmVzdWx0LnN1YnRvdGFsX2ludGVyZXN0ID0gJHNjb3BlLnN1YnRvdGFsX2ludGVyZXN0O1xuXG4gICAgfVxuXG4gIH1cblxufSkiLCIndXNlIHN0cmljdCdcblxuYXBwLmZhY3RvcnkoJ0xvYW5GYWN0b3J5JywgKCRodHRwLCAkbG9nKSA9PiB7XG5cbiAgY29uc3QgY2FsY3VsYXRlX3NjaGVkdWxlID0gKGxvYW4pID0+IHtcbiAgICBjb25zdCBkID0gbmV3IERhdGUoKTtcbiAgICBjb25zdCBkZWZhdWx0X3N0YXJ0X21vbnRoID0gZC5zZXREYXRlKGQuZ2V0TW9udGgoKSArIDEpO1xuICAgIGNvbnN0IHUgPSBuZXcgRGF0ZShkZWZhdWx0X3N0YXJ0X21vbnRoKVxuICAgIGlmICghbG9hbi5zdGFydF9tb250aCkgbG9hbi5zdGFydF9tb250aCA9IHU7XG5cbiAgICBsZXQgc2NoZWR1bGUgPSBbXTtcbiAgICBsZXQgbSA9ICtsb2FuLm51bWJlcl9vZl9tb250aHM7XG4gICAgbGV0IGFtb3VudCA9ICtsb2FuLmFtb3VudDtcbiAgICBsZXQgciA9ICtsb2FuLmN1c3RvbV9yYXRlID4gMCA/ICtsb2FuLmN1c3RvbV9yYXRlIC8gMTAwIDogK2xvYW4uZmVkZXJhbF9yYXRlO1xuICAgIGNvbnN0IGFubnVpdHlfZmFjdG9yID0gKDEgLSAxLyBNYXRoLnBvdygxICsgci9tLCBtKSkgLyAoci9tKTtcbiAgICBjb25zdCBwbXQgPSBhbW91bnQgLyBhbm51aXR5X2ZhY3RvcjtcbiAgICBjb25zdCBtb250aHMgPSBbJ0phbnVhcnknLCAnRmVicnVhcnknLCAnTWFyY2gnLCAnQXByaWwnLCAnTWF5JywgJ0p1bmUnLCAnSnVseScsICdBdWd1c3QnLCAnU2VwdGVtYmVyJywgJ09jdG9iZXInLCAnTm92ZW1iZXInLCAnRGVjZW1iZXInXTtcblxuICAgIGxldCBiYWxhbmNlID0gYW1vdW50O1xuICAgIGxldCBwYWlkX3ByaW5jaXBhbCA9IDA7XG4gICAgbGV0IHkgPSAwO1xuICAgIGZvcih2YXIgaT0wOyBpPG07IGkrKykge1xuICAgICAgaWYgKCAobG9hbi5zdGFydF9tb250aC5nZXRNb250aCgpICsgaSkgJSAxMiA9PSAxMSApIHkgKz0xO1xuICAgICAgbGV0IHllYXIgPSBsb2FuLnN0YXJ0X21vbnRoLmdldEZ1bGxZZWFyKCkgKyB5IDtcbiAgICAgIGxldCBtb250aCA9IGAke21vbnRoc1sobG9hbi5zdGFydF9tb250aC5nZXRNb250aCgpICsgaSsxKSAlIDEyIF19LSR7eWVhcn1gO1xuICAgICAgaWYgKGkgPT0gbS0xKSB7XG4gICAgICAgIGxldCBpbnRlcmVzdCA9IChiYWxhbmNlICogKHIvbSkpLnRvRml4ZWQoMik7XG4gICAgICAgIGxldCBwcmluY2lwYWwgPSAoYW1vdW50IC0gcGFpZF9wcmluY2lwYWwpLnRvRml4ZWQoMik7XG4gICAgICAgIGxldCBwYXltZW50ID0gKE51bWJlcihpbnRlcmVzdCkgKyBOdW1iZXIocHJpbmNpcGFsKSkudG9GaXhlZCgyKTtcbiAgICAgICAgYmFsYW5jZSA9IDA7XG4gICAgICAgIHNjaGVkdWxlLnB1c2goeyBtb250aCwgcGF5bWVudCwgcHJpbmNpcGFsLCBpbnRlcmVzdCwgYmFsYW5jZSB9KVxuICAgICAgfSBlbHNlIHtcblxuICAgICAgICBsZXQgcGF5bWVudCA9IHBtdC50b0ZpeGVkKDIpO1xuICAgICAgICBsZXQgaW50ZXJlc3QgPSAoYmFsYW5jZSAqIChyL20pKS50b0ZpeGVkKDIpO1xuICAgICAgICBsZXQgcHJpbmNpcGFsID0gKHBheW1lbnQgLSBiYWxhbmNlICogKHIvbSkpLnRvRml4ZWQoMik7XG4gICAgICAgIHBhaWRfcHJpbmNpcGFsICs9IE51bWJlcihwcmluY2lwYWwpO1xuICAgICAgICBiYWxhbmNlID0gKGJhbGFuY2UgLSBwcmluY2lwYWwpLnRvRml4ZWQoMik7XG4gICAgICAgIHNjaGVkdWxlLnB1c2goeyBtb250aCwgcGF5bWVudCwgcHJpbmNpcGFsLCBpbnRlcmVzdCwgYmFsYW5jZSB9KVxuICAgICAgfVxuXG4gICAgfVxuICAgIHJldHVybiBzY2hlZHVsZTtcbiAgfVxuXG5cbiAgcmV0dXJuIHsgY2FsY3VsYXRlX3NjaGVkdWxlIH1cbn0pXG4iLCIndXNlIHN0cmljdCdcblxuYXBwLmZhY3RvcnkoJ1JhdGVGYWN0b3J5JywgKCRodHRwLCAkbG9nKSA9PiB7XG4gIGxldCByYXRlcyA9IFtdO1xuXG4gIGNvbnN0IGZldGNoX3JhdGVzID0gKCkgPT4ge1xuICAgIGlmIChyYXRlcy5sZW5ndGggPT0gMCkgcmV0dXJuICRodHRwLmdldCgnL2FwaS9yYXRlcycpLnRoZW4ocmVzID0+IHJhdGVzID0gcmVzLmRhdGEpO1xuICAgIGVsc2UgaWYgKG5ldyBEYXRlIC0gcmF0ZXNbMF0udXBkYXRlZF9hdCA+IDI0ICogNjAgKiA2MCAqIDEwMDApIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvcmF0ZXMnKS50aGVuKHJlcyA9PiByYXRlcyA9IHJlcy5kYXRhKTtcbiAgICByZXR1cm4gcmF0ZXM7XG4gIH1cblxuICByZXR1cm4geyBmZXRjaF9yYXRlcyB9XG59KVxuIl19
